@(userUploads : List[UserUpload])
<ul id="navbar">
    <li><a href="@routes.Application.index">Home</a></li>
    <li><a href="@routes.Application.builder">Workflow Builder</a></li>
    <li><a href="@routes.Application.createaccount">Register</a></li>
    @if(session.get("uid") == null) {
        <li><a href="@routes.Application.login">Login</a></li>
    } else {
        <li><a href="@routes.Application.logout">Logout</a></li>
    }
</ul>

@main(title = "The Kurator 'helloworld' application") {

    <h1>Run Worms Workflow</h1>

     <script type="text/javascript">
        $(function() {
            var uploadId;

            @if(!userUploads.isEmpty()) {
                $("#upload").hide();
                $("#run").prop("disabled", false);

                uploadId = $("#uploadFile option:selected").val();

                $("#newUploadBtn").click(function() {
                    $("#userUploads").hide();
                    $("#upload").show();
                });
            } else {
                $("#run").prop("disabled", true);
            }

            $("#complete").hide();

            $("#progressbar").progressbar({
                value: false
            }).hide();

            $("#overlay").hide();
            $("#modal").hide();

            $("#upload").submit(function (event) {
                event.preventDefault();
                $("#overlay").show("fade");

                var formData = new FormData($(this)[0]);

                $.ajax({
                    url: "upload",
                    type: "POST",
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        console.log(data)
                        uploadId = data.uploadId;
                        $("#progressbar").hide("fade");
                        $("#run").prop("disabled", false);

                        $("#modal").show("fade");
                        setTimeout(function() {
                            $("#modal").hide("fade");
                            $("#overlay").hide("fade");
                        }, 1000);
                    },
                    error: function (request, status, error) {
                        $("#progressbar").hide("fade");
                        $("#error").html(error);
                    }
                });

                return false;
            });

            $("#uploadFile").change(function() {
                uploadId = $("#uploadFile option:selected").val();
            });

            $("#run").click(function() {
                $("#progressbar").show("fade");
                $.ajax({
                    url: "runworms/" + uploadId,
                    type: "GET",
                    success: function (data) {
                        $("#result").html(data.output);
                        $("#download").attr("href", "result/" + data.runId);
                        console.log(data)
                        $("#progressbar").hide("fade");
                        $("#complete").show("drop");
                    },
                    error: function (request, status, error) {
                        $("#progressbar").hide("fade");
                        $("#error").html(data);
                    }
                });
            });
        });
     </script>
    @if(!userUploads.isEmpty()) {
        <div id="userUploads">
            Input file:
            <select id="uploadFile">
                @for(userUpload <- userUploads) {
                    <option value="@userUpload.id">@userUpload.fileName</option>
                }
            </select>
            <button id="newUploadBtn">Upload New File</button>
        </div>
        <br />
    }
    <form id="upload" enctype="multipart/form-data">Upload file: <input type="file" id="input" name="input"><input type="submit" value="Upload"></form>
    <button id="run">Run workflow</button>
    <div id="progressbar" class="ui-progressbar-indeterminate"></div>
    <div id="complete">
        Result: <span id="result"></span>
        <a id="download">Download csv...</a>
    </div>
    <div id="error"></div>

    <br />
    <div id='overlay'></div>
    <div id='modal'>
        <div id='content'>File upload complete!</div>
    </div>
}
